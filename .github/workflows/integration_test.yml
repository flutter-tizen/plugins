# TODO: Support running all integration tests for master branch when
# it's possible to run self-hosted runners in parallel.
name: Integration Test

on: 
#  push:
#    branches:
#      - "master"
  pull_request:

jobs:
  changed_packages:
    runs-on: [self-hosted, linux]
    if: ${{ github.repository_owner == 'flutter-tizen' && github.event_name == 'pull_request' }}
    steps:
      - name: Check out repository
        uses: actions/checkout@v2
        with:
          fetch-depth: 2
      - name: Run script
        run: |
          `pwd`/tools/run_command.py test --run-on-changed-packages --base-sha=$(git rev-parse HEAD^) --exclude wearable_rotary image_picker camera webview_flutter video_player permission_handler geolocator battery connectivity device_info package_info sensors share wifi_info google_maps_flutter
        # The following packages are excluded from tests: 
        #   wearable_rotary, image_picker: no tests.
        #   camera: the current test target is wearable emulator 5.5, which doesn't support this package.
        #   webview_flutter: the current test target is wearable emulator 5.5, which doesn't support this package.
        #   video_player: test frequently breaks due to memory issue(https://github.com/flutter-tizen/plugins/issues/135).
        #   permission_handler: permission related test.
        #   geolocator: test requires console manipulation.
        #   battery, connectivity, device_info, package_info, sensors, share, wifi_info: deprecated.
        #   google_maps_flutter: device limitation not yet specified.
        

#  all:
#    runs-on: [self-hosted, linux]
#    if: ${{ github.repository_owner == 'flutter-tizen' && github.ref == 'refs/heads/master' }}
#    steps:
#      - name: Check out repository
#        uses: actions/checkout@v2
#      - name: Run script
#        run: |
#          `pwd`/tools/run_command.py test --exclude wearable_rotary camera webview_flutter image_picker video_player
